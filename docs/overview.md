# Огляд проєкту Referendum

Це соціальна платформа для проведення онлайн-опитувань і референдумів. Проєкт побудований на шаблоні **Yii 2 Advanced**, що забезпечує поділ на фронтенд, бекенд та спільні компоненти.

## Основні можливості

- створення та редагування опитувань;
- голосування за варіанти відповідей;
- коментування та оцінка коментарів;
- побудова графіків результатів.

## Структура

- **frontend/** – публічна частина сайту з модулями `poll`, `user` та `ajax`;
- **backend/** – адміністративна панель;
- **common/** – спільні моделі та налаштування.

## Розробницьке середовище

Для швидкого старту використовується `docker-compose`:

```bash
docker-compose up -d
```

Після запуску фронтенд доступний на [http://localhost:20080](http://localhost:20080), а бекенд – на [http://localhost:21080](http://localhost:21080).

## Встановлення без Docker

```bash
composer install
php init
cp .env.example .env
```

Після копіювання файлу `.env` заповніть у ньому змінні `DB_DSN`, `DB_USERNAME`, `DB_PASSWORD` та за потреби `DB_TEST_DSN`.

## Тестування

Фреймворк PHPUnit налаштований у файлі `phpunit.xml`. Базові прикладові тести містяться в каталозі `tests/`.

```bash
vendor/bin/phpunit
```

Документація буде доповнюватися у міру розвитку проєкту.

## Канонічні піддомени

Сторінки опитувань автоматично перенаправляються на піддомен, що відповідає мові опитування. Наприклад, звернення до
`https://ua.referendum.social/poll/573` або `https://referendum.social/poll/573` буде переадресовано на
`https://en.referendum.social/poll/573`, якщо опитування створене англійською. Для коректної індексації додається тег
`<link rel="canonical">` з посиланням на канонічну адресу.

## Мікророзмітка та часові пояси

Дата публікації опитувань у мікророзмітці `DiscussionForumPosting` тепер містить часовий пояс **America/New_York**. Часовий пояс задається в атрибуті `content` і не відображається користувачам на сторінці.
Мета‑теги `mainEntityOfPage` та `url` отримують абсолютну адресу сторінки через `Yii::$app->request->absoluteUrl`, що гарантує коректні посилання незалежно від домену.
У `<head>` сторінки додається мета‑тег `og:image`, що генерується на основі `Yii::$app->request->hostInfo` і вказує на файл `/img/kvadrat.png` поточного піддомену.

## Генерація Sitemap

Для побудови XML‑карт сайту використовується консольна команда:

```bash
php yii sitemap/index
```

До sitemap додаються всі існуючі опитування незалежно від статусу. Після видалення опитування через адмінку воно автоматично припиняє потрапляти до карти сайту.

## Текстовий опис тегів

На сторінках тегів відображається автоматично сформований блок із короткою статистикою: дата створення тегу, кількість пов'язаних опитувань, найпопулярніше опитування (за кількістю голосів), опитування з найбільшим рейтингом та дата останнього опитування. Назви опитувань містять посилання на відповідні сторінки.

В англомовній локалізації для кращої індексації використовуються ключові фрази на кшталт "Opinions {tag} polling" та "polls {tag} update".

Для російської та норвезької версій додано оновлені переклади цього опису, а формат дат автоматично підлаштовується під вибрану мову.

Опис англійською також очищено від залишків українського тексту, тож усі локалі відображають повні переклади без змішування мов.

## Виправлення JavaScript

Скрипти сторінки опитування тепер використовують повне ім'я `jQuery` замість скорочення `$`. Це усуває помилку `Uncaught ReferenceError: $ is not defined`, що з'являлась у браузері під час роботи з формою додавання відповіді та фільтрами.


